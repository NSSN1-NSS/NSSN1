<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVFIT - العارض النقطي المحسن</title>
    <style>
        :root {
            --primary-color: #0078d7;
            --secondary-color: #106ebe;
            --background-color: #f0f8ff;
            --panel-bg: #ffffff;
            --text-color: #000000;
            --control-width: 300px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--background-color), #ffffff);
            color: var(--text-color);
            overflow: hidden;
            height: 100vh;
            display: flex;
        }

        .control-panel {
            width: var(--control-width);
            height: 100vh;
            background: var(--panel-bg);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            border-left: 1px solid #e0e0e0;
        }

        .panel-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .panel-content {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layer {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .layer h3 {
            margin-bottom: 8px;
            color: var(--primary-color);
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 5px;
            font-size: 14px;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            font-size: 13px;
            direction: rtl;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 215, 0.2);
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: block;
            padding: 8px;
            background: var(--primary-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .file-label:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .control-button {
            padding: 10px;
            background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 12px;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .control-button.primary {
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .control-button.success {
            background: linear-gradient(to bottom, #4caf50, #388e3c);
            color: white;
        }

        .control-button.warning {
            background: linear-gradient(to bottom, #ff9800, #f57c00);
            color: white;
        }

        .control-button.danger {
            background: linear-gradient(to bottom, #f44336, #d32f2f);
            color: white;
        }

        .slider-container {
            margin-bottom: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .motion-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .motion-button {
            padding: 8px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 11px;
        }

        .motion-button.active {
            background: var(--primary-color);
            color: white;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }

        .theme-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .theme-option.active {
            border-color: #333;
            transform: scale(1.1);
        }

        .display-panel {
            flex: 1;
            height: 100vh;
            display: flex;
            flex-direction: column;
            margin-right: var(--control-width);
        }

        .display-header {
            height: 60px;
            background: var(--panel-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .display-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .display-controls {
            display: flex;
            gap: 10px;
        }

        .display-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        #mainCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            transition: opacity 0.3s ease;
        }

        .grid-overlay.active {
            opacity: 0.3;
        }

        .image-preview {
            margin-top: 8px;
            text-align: center;
            min-height: 80px;
            background: #f0f0f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ddd;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 80px;
            border-radius: 6px;
        }

        .image-preview.empty::after {
            content: 'لم يتم اختيار صورة';
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div class="control-panel">
    <div class="panel-header">PVFIT - العارض النقطي المحسن</div>
    <div class="panel-content">
        <div class="layer">
            <h3>النصوص</h3>
            <textarea id="textInput" placeholder="أدخل النص هنا (حتى 256 حرف)" maxlength="256">المطور: المستشار التدريبي
ناصر سعدي سعيد
مدير فني - مجلس أربيل
NSSN1</textarea>
            <button class="file-label" onclick="showText()">اظهر النص</button>
            <button class="file-label" style="background:#f44336" onclick="hideText()">اخفي النص</button>
        </div>
        <div class="layer">
            <h3>الصور</h3>
            <input type="file" id="imageInput" class="file-input" accept=".png,.jpg,.jpeg,.svg">
            <label for="imageInput" class="file-label">اختر صورة (PNG, JPG, SVG)</label>
            <div id="imagePreview" class="image-preview empty"></div>
            <button class="file-label" onclick="showImage()">اظهر الصورة</button>
            <button class="file-label" style="background:#f44336" onclick="hideImage()">اخفي الصورة</button>
        </div>
        <div class="layer">
            <h3>التحكم الأساسي</h3>
            <div class="control-buttons">
                <button class="control-button primary" onclick="setMotion('origin')">أصل</button>
                <button class="control-button warning" onclick="setMotion('static')">ثابت</button>
                <button class="control-button success" onclick="setMotion('resume')">استئناف</button>
            </div>
        </div>
        <div class="layer">
            <h3>أنماط الحركة</h3>
            <div class="motion-buttons">
                <button class="motion-button" onclick="setMotion('spiral')">لولبي</button>
                <button class="motion-button" onclick="setMotion('scatter')">تشتت</button>
                <button class="motion-button" onclick="setMotion('vortex')">زوبعي</button>
                <button class="motion-button" onclick="setMotion('random')">عشوائي</button>
                <button class="motion-button" onclick="setMotion('rain')">مطري</button>
                <button class="motion-button" onclick="setMotion('wave')">موجي</button>
                <button class="motion-button" onclick="setMotion('slide')">سلايد</button>
                <button class="motion-button" onclick="setMotion('circular')">حلقي</button>
                <button class="motion-button" onclick="setMotion('explode')">انفجاري</button>
            </div>
        </div>
        <div class="control-buttons">
            <button class="control-button primary" onclick="startAnimation()">تشغيل</button>
            <button class="control-button danger" onclick="stopAnimation()">إيقاف</button>
            <button class="control-button success" onclick="exportData()">تصدير</button>
            <button class="control-button" onclick="resetSettings()">إعادة</button>
        </div>
        <div class="slider-container">
            <div class="slider-label">
                <span>سرعة الحركة</span>
                <span id="speedValue">1.0</span>
            </div>
            <input type="range" min="0.1" max="3.0" step="0.1" value="1.0" class="slider" id="speedSlider" oninput="updateSpeed()">
        </div>
        <div class="slider-container">
            <div class="slider-label">
                <span>حجم النقاط</span>
                <span id="sizeValue">1.5px</span>
            </div>
            <input type="range" min="0.8" max="10" step="0.1" value="1.5" class="slider" id="sizeSlider" oninput="updateSize()">
        </div>
        <div class="slider-container">
            <div class="slider-label">
                <span>دقة النقاط</span>
                <span id="densityValue">300</span>
            </div>
            <input type="range" min="100" max="1000" step="50" value="300" class="slider" id="densitySlider" oninput="updateDensity()">
        </div>
        <div class="layer">
            <h3>الثيمات</h3>
            <div class="theme-selector">
                <div class="theme-option active" style="background: linear-gradient(135deg, #0078d7, #106ebe);" onclick="changeTheme('windows10')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #d32f2f, #b71c1c);" onclick="changeTheme('red')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #388e3c, #1b5e20);" onclick="changeTheme('green')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #f57c00, #e65100);" onclick="changeTheme('orange')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #7b1fa2, #4a148c);" onclick="changeTheme('purple')"></div>
            </div>
        </div>
    </div>
</div>

<div class="display-panel">
    <div class="display-header">
        <div class="display-title">العارض النقطي للصور والنصوص</div>
        <div class="display-controls">
            <button class="control-button" onclick="toggleFullscreen()">ملء الشاشة</button>
            <button class="control-button" onclick="toggleGrid()">الشبكة</button>
        </div>
    </div>
    <div class="display-content">
        <canvas id="mainCanvas"></canvas>
        <div class="grid-overlay" id="gridOverlay"></div>
    </div>
</div>

<script>
let canvas, ctx;
let animationId = null;
let isAnimating = false;
let particles = [];
let showTextLayer = false;
let showImageLayer = false;
let currentMotion = 'resume';
let currentImage = null;

const settings = {
    speed: 1.0,
    particleSize: 1.5,
    density: 300
};

// Particle class - محسن للأداء
class Particle {
    constructor(x, y, color, targetX, targetY) {
        this.x = x;
        this.y = y;
        this.originX = targetX;
        this.originY = targetY;
        this.targetX = targetX;
        this.targetY = targetY;
        this.color = color;
        this.size = settings.particleSize;
        this.vx = 0;
        this.vy = 0;
        this.friction = 0.95;
        this.springFactor = 0.2;
        this.angle = Math.random() * Math.PI * 2;
        this.phase = Math.random() * Math.PI * 2;
    }

    update() {
        if (currentMotion === 'origin') {
            this.targetX = this.originX;
            this.targetY = this.originY;
        } else if (currentMotion === 'static') {
            this.targetX = this.x;
            this.targetY = this.y;
        } else if (currentMotion === 'spiral') {
            this.angle += 0.05 * settings.speed;
            const radius = Math.sqrt(Math.pow(this.x - canvas.width/2, 2) + Math.pow(this.y - canvas.height/2, 2));
            this.targetX = canvas.width/2 + radius * Math.cos(this.angle);
            this.targetY = canvas.height/2 + radius * Math.sin(this.angle);
        } else if (currentMotion === 'scatter') {
            if (Math.random() < 0.01) {
                this.targetX = Math.random() * canvas.width;
                this.targetY = Math.random() * canvas.height;
            }
        } else if (currentMotion === 'vortex') {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const dx = this.x - centerX;
            const dy = this.y - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx);
            const targetAngle = angle + 0.05 * settings.speed;
            const targetDistance = distance * 0.99;
            this.targetX = centerX + targetDistance * Math.cos(targetAngle);
            this.targetY = centerY + targetDistance * Math.sin(targetAngle);
        } else if (currentMotion === 'random') {
            this.targetX += (Math.random() - 0.5) * 10 * settings.speed;
            this.targetY += (Math.random() - 0.5) * 10 * settings.speed;
        } else if (currentMotion === 'rain') {
            this.targetY += 5 * settings.speed;
            if (this.targetY > canvas.height) {
                this.targetY = 0;
                this.targetX = Math.random() * canvas.width;
            }
        } else if (currentMotion === 'wave') {
            this.phase += 0.05 * settings.speed;
            this.targetY = this.originY + Math.sin(this.phase + this.originX * 0.01) * 30;
        } else if (currentMotion === 'slide') {
            this.targetX += 2 * settings.speed;
            if (this.targetX > canvas.width) {
                this.targetX = 0;
            }
        } else if (currentMotion === 'circular') {
            this.angle += 0.02 * settings.speed;
            const radius = 100;
            this.targetX = canvas.width/2 + radius * Math.cos(this.angle + this.originX * 0.01);
            this.targetY = canvas.height/2 + radius * Math.sin(this.angle + this.originY * 0.01);
        } else if (currentMotion === 'explode') {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const dx = this.x - centerX;
            const dy = this.y - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 200) {
                this.targetX = this.x + dx * 0.1 * settings.speed;
                this.targetY = this.y + dy * 0.1 * settings.speed;
            }
        }

        // Spring physics - محسّن للأداء
        const dx = this.targetX - this.x;
        const dy = this.targetY - this.y;
        this.vx += dx * this.springFactor;
        this.vy += dy * this.springFactor;
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.x += this.vx;
        this.y += this.vy;
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

function init() {
    canvas = document.getElementById('mainCanvas');
    ctx = canvas.getContext('2d');
    
    resizeCanvas();
    setupEventListeners();
    loadDefaultImage();
    
    window.addEventListener('resize', resizeCanvas);
}

function setupEventListeners() {
    document.getElementById('imageInput').addEventListener('change', handleImageUpload);
}

function handleImageUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(event) {
        currentImage = new Image();
        currentImage.onload = function() {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = `<img src="${event.target.result}">`;
            preview.classList.remove('empty');
        };
        currentImage.src = event.target.result;
    };
    reader.readAsDataURL(file);
}

function resizeCanvas() {
    const content = document.querySelector('.display-content');
    canvas.width = content.clientWidth;
    canvas.height = content.clientHeight;
}

function loadDefaultImage() {
    currentImage = new Image();
    currentImage.onload = function() {
        generateParticlesFromImage();
        showImageLayer = true;
        showText();
        startAnimation();
    };
    const svgString = `<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300">
        <defs>
            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#0078d7;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:1" />
            </linearGradient>
        </defs>
        <circle cx="150" cy="150" r="140" fill="url(#grad1)"/>
        <text x="150" y="180" font-size="80" fill="white" text-anchor="middle" font-weight="bold">NSSN1</text>
    </svg>`;
    currentImage.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
}

function showText() {
    const text = document.getElementById('textInput').value;
    generateParticlesFromText(text);
    showTextLayer = true;
    if (!isAnimating) startAnimation();
}

function hideText() {
    showTextLayer = false;
    particles = particles.filter(p => p.type !== 'text');
}

function showImage() {
    if (!currentImage) {
        alert('الرجاء اختيار صورة أولاً');
        return;
    }
    generateParticlesFromImage();
    showImageLayer = true;
    if (!isAnimating) startAnimation();
}

function hideImage() {
    showImageLayer = false;
    particles = particles.filter(p => p.type !== 'image');
}

function generateParticlesFromText(text) {
    // إزالة النقاط النصية القديمة
    particles = particles.filter(p => p.type !== 'text');
    
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = settings.density;
    tempCanvas.height = settings.density;
    
    tempCtx.fillStyle = '#ffffff';
    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
    
    const fontSize = Math.min(tempCanvas.width / 10, 60);
    tempCtx.font = `bold ${fontSize}px Arial`;
    tempCtx.fillStyle = '#000000';
    tempCtx.textAlign = 'center';
    tempCtx.textBaseline = 'middle';
    
    const lines = text.split('\n');
    const lineHeight = fontSize * 1.2;
    const startY = (tempCanvas.height - (lines.length * lineHeight)) / 2;
    
    lines.forEach((line, i) => {
        tempCtx.fillText(line, tempCanvas.width / 2, startY + (i * lineHeight) + lineHeight/2);
    });
    
    const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
    const data = imageData.data;
    
    // تحسين كثافة النقاط للأداء
    const step = Math.max(2, Math.floor(Math.min(tempCanvas.width, tempCanvas.height) / 50));
    
    for (let y = 0; y < tempCanvas.height; y += step) {
        for (let x = 0; x < tempCanvas.width; x += step) {
            const index = (y * tempCanvas.width + x) * 4;
            const a = data[index + 3];
            
            if (a > 128) {
                const targetX = (x / tempCanvas.width) * canvas.width;
                const targetY = (y / tempCanvas.height) * canvas.height;
                const color = `rgb(${data[index]}, ${data[index+1]}, ${data[index+2]})`;
                
                // Random starting position
                const startX = Math.random() * canvas.width;
                const startY = Math.random() * canvas.height;
                
                const particle = new Particle(startX, startY, color, targetX, targetY);
                particle.type = 'text';
                particles.push(particle);
            }
        }
    }
}

function generateParticlesFromImage() {
    // إزالة النقاط الصورية القديمة
    particles = particles.filter(p => p.type !== 'image');
    
    if (!currentImage) return;
    
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = settings.density;
    tempCanvas.height = settings.density;
    
    // Calculate scaling to fit image in tempCanvas
    const scale = Math.min(
        tempCanvas.width / currentImage.width,
        tempCanvas.height / currentImage.height
    );
    
    const width = currentImage.width * scale;
    const height = currentImage.height * scale;
    const x = (tempCanvas.width - width) / 2;
    const y = (tempCanvas.height - height) / 2;
    
    tempCtx.drawImage(currentImage, x, y, width, height);
    
    const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
    const data = imageData.data;
    
    // تحسين كثافة النقاط للأداء
    const step = Math.max(2, Math.floor(Math.min(tempCanvas.width, tempCanvas.height) / 50));
    
    for (let y = 0; y < tempCanvas.height; y += step) {
        for (let x = 0; x < tempCanvas.width; x += step) {
            const index = (y * tempCanvas.width + x) * 4;
            const a = data[index + 3];
            
            if (a > 128) {
                const targetX = (x / tempCanvas.width) * canvas.width;
                const targetY = (y / tempCanvas.height) * canvas.height;
                const color = `rgb(${data[index]}, ${data[index+1]}, ${data[index+2]})`;
                
                // Random starting position
                const startX = Math.random() * canvas.width;
                const startY = Math.random() * canvas.height;
                
                const particle = new Particle(startX, startY, color, targetX, targetY);
                particle.type = 'image';
                particles.push(particle);
            }
        }
    }
}

function startAnimation() {
    if (isAnimating) return;
    isAnimating = true;
    animate();
}

function stopAnimation() {
    isAnimating = false;
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
}

function animate() {
    if (!isAnimating) return;
    
    // استخدام تقنية Double Buffering لتحسين الأداء
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // تحديث ورسم النقاط
    particles.forEach(particle => {
        particle.update();
        particle.draw();
    });
    
    animationId = requestAnimationFrame(animate);
}

function setMotion(motion) {
    currentMotion = motion;
    document.querySelectorAll('.motion-button').forEach(btn => {
        btn.classList.remove('active');
    });
    if (event && event.target) {
        event.target.classList.add('active');
    }
}

function updateSpeed() {
    const value = parseFloat(document.getElementById('speedSlider').value);
    settings.speed = value;
    document.getElementById('speedValue').textContent = value.toFixed(1);
}

function updateSize() {
    const value = parseFloat(document.getElementById('sizeSlider').value);
    settings.particleSize = value;
    document.getElementById('sizeValue').textContent = value.toFixed(1) + 'px';
    
    // Update existing particles
    particles.forEach(particle => {
        particle.size = value;
    });
}

function updateDensity() {
    const value = parseInt(document.getElementById('densitySlider').value);
    settings.density = value;
    document.getElementById('densityValue').textContent = value;
    
    // Regenerate particles with new density
    if (showTextLayer) {
        const text = document.getElementById('textInput').value;
        generateParticlesFromText(text);
    }
    
    if (showImageLayer) {
        generateParticlesFromImage();
    }
}

function changeTheme(theme) {
    document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('active');
    });
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    const themes = {
        windows10: { primary: '#0078d7', secondary: '#106ebe', background: '#f0f8ff' },
        red: { primary: '#d32f2f', secondary: '#b71c1c', background: '#ffebee' },
        green: { primary: '#388e3c', secondary: '#1b5e20', background: '#e8f5e9' },
        orange: { primary: '#f57c00', secondary: '#e65100', background: '#fff3e0' },
        purple: { primary: '#7b1fa2', secondary: '#4a148c', background: '#f3e5f5' }
    };
    
    const selectedTheme = themes[theme];
    document.documentElement.style.setProperty('--primary-color', selectedTheme.primary);
    document.documentElement.style.setProperty('--secondary-color', selectedTheme.secondary);
    document.documentElement.style.setProperty('--background-color', selectedTheme.background);
}

function exportData() {
    const dataURL = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.download = 'pvfit-export.png';
    link.href = dataURL;
    link.click();
}

function resetSettings() {
    settings.speed = 1.0;
    settings.particleSize = 1.5;
    settings.density = 300;
    
    document.getElementById('speedSlider').value = settings.speed;
    document.getElementById('sizeSlider').value = settings.particleSize;
    document.getElementById('densitySlider').value = settings.density;
    
    updateSpeed();
    updateSize();
    updateDensity();
    
    currentMotion = 'resume';
    document.querySelectorAll('.motion-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    changeTheme('windows10');
    document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('active');
    });
    document.querySelector('.theme-option').classList.add('active');
}

function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

function toggleGrid() {
    const gridOverlay = document.getElementById('gridOverlay');
    gridOverlay.classList.toggle('active');
}

// Initialize the application
window.onload = init;
</script>
</body>
</html>